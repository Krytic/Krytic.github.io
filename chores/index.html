<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Chore Monitor</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

		<style type="text/css">
			* {
				font-size: 3vw;
			}

			table {
				text-align: center;
			}
			thead tr {
				font-size: 5vw;
			}

			td[id^=task-] {
				font-weight: bold;
			}

			.hero .title {
				font-size: 8vw;
			}

			.hero .subtitle {
				font-size: 5vw;
			}

			.notification {
				margin-top: 2vh;
				margin-bottom: 2vh;
				text-align: center;
			}
		</style>
	</head>
	<body>
		<section class="hero is-medium is-info">
			<div class="hero-body has-text-centered">
				<p class="title">
					Chore Monitor
				</p>
				<p class="subtitle" id="flatname">
					Ryan, Jasmine, Sean, &amp; Frazer's flat
				</p>
			</div>
		</section>

		<div id="js-warning" class="container">
			<div class="notification is-danger is-light">
				<strong>Javascript is required to view this content.</strong>
			</div>
		</div>

		<div class="container">
			<div class="notification is-info is-light">
				For the week beginning <strong id="week_beginning"></strong>
			</div>
		</div>

		<table class="table is-fullwidth">
			<thead>
				<tr><th>Inside</th><th>Person</th><th>Outside</th></tr>
			</thead>
			<tbody>
				<tr><td id="lawn1">Kitchen</td><td id="task-1"></td><td id="outside-task-1"></td></tr>
				<tr><td id="lawn1">Bathroom</td><td id="task-2"></td><td id="outside-task-2"></td></tr>
				<tr><td id="lawn1">Bins</td><td id="task-3"></td><td id="outside-task-3"></td></tr>
				<tr><td id="lawn1">Lounge / Hallway</td><td id="task-4"></td><td id="outside-task-4"></td></tr>
			</tbody>
		</table>

		<div class="container">
			<div class="notification is-info is-light" id="isotap">
				<strong>View the flat isolation plan</strong>
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

		<script type="text/javascript">
			$(document).ready(function() {
				document.getElementById('js-warning').style.display = 'none';

				Flatmates = ['Sean', 'Ryan', 'Frazer', 'Jasmine'];
				OutsideChores = {
					'Sean': 'Weeding',
					'Ryan': 'Front Lawn',
					'Jasmine': 'Back Lawn',
					'Frazer': 'Weedwhacking'
				};

				var OriginDate = new Date(2022, 2, 7, 0, 0, 0, 0);
				var ThisWeek = new Date();
				ThisWeek.setDate(ThisWeek.getDate() - (ThisWeek.getDay() + 6) % 7); // This date is the most recent Monday

		        function DaysBetween(OriginDate, TargetDate) {
		            var origin = new Date(OriginDate),
		                days = new Date(TargetDate).setHours(0, 0, 0, 0) - origin.setHours(0, 0, 0, 0);
		            return Math.round(days / 864e5);
		        }

		        function GetChoreFor(e) {
		            var DaysSinceInception = Fa(e),
		                idx = DaysSinceInception % Flatmates.length;
		            return Flatmates[idx];
		        }

		        function Fa(TargetDate) {
		            return DaysBetween(OriginDate, TargetDate);
		        }

		        document.getElementById('week_beginning').innerHTML = ThisWeek.toLocaleString('default', { day: 'numeric', month: 'short' });;

		        for (var i = Flatmates.length; i >= 1; i--) {
		        	var This_Person = new Date;
		        	This_Person.setDate(ThisWeek.getDate() - (ThisWeek.getDay() + 6) % 7 + i); // Get the date of the most recent Monday,
		        	document.getElementById('task-' + i).innerHTML = GetChoreFor(This_Person);
		        	document.getElementById('outside-task-' + i).innerHTML = OutsideChores[GetChoreFor(This_Person)];
		        }

		        let Ma = Flatmates;

		        Sa = Ma.sort(() => Math.random() - 0.5);

		        Fs = "";

		        for (var j = 0; j <= Ma.length; j++) {
		        	if (Ma[j] != undefined) {
		        		if(j==2) {
		        			endc = " & ";
		        		}
		        		else if(j==3) {
		        			endc = "'s flat";
		        		}
		        		else {
		        			endc = ", ";
		        		}

			        	Fs = Fs + Ma[j] + endc;
		        	}
		        }

		        $('#isotap').on('click tap', function(){
		        	console.log("Tap received");
		        	window.location = "https://docs.google.com/spreadsheets/d/1trDD6hFQKQKLf5Mc4U-7M5xOwQrCj-_s2gOVpnHJ3ho/edit#gid=0";
		        });

		        document.getElementById('flatname').innerHTML = Fs;
		    });
		</script>
	</body>
</html>
